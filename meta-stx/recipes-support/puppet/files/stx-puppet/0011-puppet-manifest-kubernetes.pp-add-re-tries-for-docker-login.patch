From 911ce04cdb47f110e8f9bd8be79ab69fcf13b107 Mon Sep 17 00:00:00 2001
From: Jackie Huang <jackie.huang@windriver.com>
Date: Wed, 18 Nov 2020 09:45:54 +0800
Subject: [PATCH] kubernetes.pp: add re-tries for docker login

Upstream-Status: Inappropriate [workaround]

Signed-off-by: Jackie Huang <jackie.huang@windriver.com>
---
 puppet-manifests/src/modules/platform/manifests/kubernetes.pp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/puppet-manifests/src/modules/platform/manifests/kubernetes.pp b/puppet-manifests/src/modules/platform/manifests/kubernetes.pp
index 3fa1c8a..393ea6b 100644
--- a/puppet-manifests/src/modules/platform/manifests/kubernetes.pp
+++ b/puppet-manifests/src/modules/platform/manifests/kubernetes.pp
@@ -269,6 +269,8 @@ class platform::kubernetes::master::init
     -> exec { 'login local registry':
       command   => "docker login registry.local:9001 -u ${::platform::dockerdistribution::params::registry_username} -p ${::platform::dockerdistribution::params::registry_password}", # lint:ignore:140chars
       logoutput => true,
+      tries     => 3,
+      try_sleep => 1,
     }
 
     -> exec { 'kubeadm to pre pull images':
-- 
2.7.4

